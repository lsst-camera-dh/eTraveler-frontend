<%-- 
    Document   : processRows
    Created on : Mar 25, 2013, 1:55:30 PM
    Author     : focke
--%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@taglib prefix="sql" uri="http://java.sun.com/jsp/jstl/sql" %>
<%@taglib prefix="traveler" tagdir="/WEB-INF/tags"%>

<%@tag description="This expands the children for processTable" pageEncoding="US-ASCII"%>

<%@attribute name="parentId" required="true"%>
<%@attribute name="prefix" %>

<sql:query var="children" dataSource="jdbc/rd-lsst-cam">
    select 
    PE.child, PE.step, P.processName 
    from ProcessEdge PE, Process P
    where PE.parent=?
    and
    PE.child=P.id
    order by PE.step
    <sql:param value="${parentId}"/>
</sql:query>

<c:forEach var="row" items="${children.rows}">
    <c:choose>
        <c:when test="${! empty prefix}">
            <c:set var="hierStep" value="${prefix}.${row.step}"/>
        </c:when>
        <c:otherwise>
            <c:set var="hierStep" value="${row.step}"/>
        </c:otherwise>
    </c:choose>
    <tr>
        <td>${hierStep}</td>
        <td>${row.processName}</td>
    </tr>
    <traveler:processRows parentId="${row.child}" prefix="${hierStep}"/>
</c:forEach>
