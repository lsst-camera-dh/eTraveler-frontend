<%-- 
    Document   : processRows
    Created on : Mar 25, 2013, 1:55:30 PM
    Author     : focke
--%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@taglib prefix="sql" uri="http://java.sun.com/jsp/jstl/sql" %>
<%@taglib prefix="traveler" tagdir="/WEB-INF/tags"%>

<%@tag description="This expands the children for processTable" pageEncoding="US-ASCII"%>

<%@attribute name="parentId" required="true"%>
<%@attribute name="prefix"%>
<%@attribute name="processPath" required="true"%>

<sql:query var="children" dataSource="jdbc/rd-lsst-cam">
    select 
    PE.child, PE.step, P.processName, P.id 
    from ProcessEdge PE, Process P
    where PE.parent=?
    and
    PE.child=P.id
    order by PE.step
    <sql:param value="${parentId}"/>
</sql:query>

<c:if test="${! empty prefix}">
    <c:set var="prefixDot" value="${prefix}."/>
</c:if>
    
<c:forEach var="row" items="${children.rows}">
    <c:set var="hierStep" value="${prefixDot}${row.step}"/>
    <c:set var="myProcessPath" value="${processPath}.${row.child}"/>
    <c:url value="dumpProcess.jsp" var="childLink">
        <c:param name="processPath" value="${myProcessPath}"/>
    </c:url>
    <tr>
        <td>${hierStep}</td>
        <td><a href="${childLink}">${row.processName}</a></td>
    </tr>
    <traveler:processRows parentId="${row.child}" prefix="${hierStep}" processPath="${myProcessPath}"/>
</c:forEach>
