<%-- 
    Document   : displayProcess
    Created on : Jan 31, 2013, 6:21:40 PM
    Author     : focke
--%>

<%@page contentType="text/html" pageEncoding="US-ASCII"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@taglib prefix="sql" uri="http://java.sun.com/jsp/jstl/sql" %>
<%@taglib prefix="display" uri="http://displaytag.sf.net" %>
<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
        <title>Process</title>
    </head>
    <body>
        <%
            String hardwareId = request.getParameter("hardwareId");
            String inNCR = request.getParameter("inNCR");
            String processId = request.getParameter("processId");
            String processEdgeId = request.getParameter("processEdgeId");
        %>
        <h2>
            Process <%=processId%>
        </h2>
        <h1><%=hardwareId%>, <%=processId%>, <%=processEdgeId%>, <%=inNCR%></h1>
 
        <sql:query var="process" dataSource="jdbc/rd-lsst-cam">
            select * from Process where id=<%=processId%>
        </sql:query>

        <form METHOD=POST ACTION="createChildActivity.jsp">
            <input type="hidden" name="hardwareId" value="<%=hardwareId%>">       
            <input type="hidden" name="inNCR" value="<%=inNCR%>">       
            <input type="hidden" name="processId" value="<%=processId%>">       
            <input type="hidden" name="processEdgeId" value="<%=processEdgeId%>">
            
            <c:if test="${! empty process.rows[0]['hardwareRelationshipTypeId']}">
               <sql:query var="potentialComponents" dataSource="jdbc/rd-lsst-cam">
                    select Hardware.id, HardwareType.name 
                    from Hardware, HardwareType, HardwareRelationshipType
                    where 
                    HardwareRelationshipType.id=${process.rows[0]['hardwareRelationshipTypeId']}
                    and
                    HardwareType.id=HardwareRelationshipType.componentTypeId
                    and
                    Hardware.TypeId=HardwareRelationshipType.componentTypeId
                    and 
                    Hardware.id in (select hardwareId from Activity where end is not null)
                    and
                    Hardware.id not in (select componentId from HardwareRelationship where end is null)
               </sql:query>
                <c:out value="${potentialComponents.rows[0]['name']}:"/>

                <select name="componentId">
                    <c:forEach var="row" items="${potentialComponents.rows}" varStatus="status">
                        <option value="${row.id}">${row.id}</option>
                    </c:forEach>
                </select>
            </c:if>            
            
            <INPUT TYPE=SUBMIT value="Initiate">
        </form>    
    </body>
</html>
